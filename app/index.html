<!doctype html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>VexTheory</title>

    <!-- build:css styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->

    <style>
      #scaleSelector {
        display: block;
      }
    </style>
  </head>
  <body>
    <select id="scaleSelector"></select>

    <!-- testing canvas -->
    <canvas id="testDiv">
      tabstave
        notation=true
        key=Em time=4/4

        notes :8 0/6 2/6 3/6 0/5 2/5 3/5 0/4 2/4
        text  :8, E, F#, G, A, B, C, D, E
    </canvas>

    <!-- vendor js -->
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../bower_components/underscore/underscore-min.js"></script>
    <script src="../node_modules/vextab/releases/vextab-div.js"></script>

    <!-- build:js scripts/main.js -->
    <script src="scripts/vextheory.js"></script>

    <script>
      function capitaliseFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
      }

      function renderScaleSelectionOptions() {
        _.each(_.keys(VexTheory.config.scales), function(scale) {

          var $scaleGroup = $('<optgroup>')
            .attr('label', capitaliseFirstLetter(scale));

          _.each(VexTheory.config.notes, function(note) {
            $scaleGroup.append(
              $('<option>').val(note).text(note)
            );
          });

          $('#scaleSelector').append($scaleGroup);
        });
      }

      $(function() {
        renderScaleSelectionOptions();

        // Rendering function
        var renderVexFlowCanvas = function() {
          console.log('rendering vex canvas');
          var myCanvas = document.getElementById('testDiv');
          renderer = new Vex.Flow.Renderer(myCanvas, Vex.Flow.Renderer.Backends.CANVAS);

          artist = new VexTabDiv.Artist(10, 10, 600, {scale: 1});
          vextab = new VexTab(artist);

          vextab.parse(myCanvas.textContent);
          artist.render(renderer);
        };

        renderVexFlowCanvas();
        $('#scaleSelector').on('change', renderVexFlowCanvas);
      });
    </script>
</body>
</html>
